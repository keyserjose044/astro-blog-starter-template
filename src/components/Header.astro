---
import HeaderLink from './HeaderLink.astro';
import { SITE_TITLE } from '../consts';

// Normalize base URL
const rawBase = import.meta.env.BASE_URL || '/';
const base = rawBase.endsWith('/') ? rawBase : `${rawBase}/`;
const link = (p: string = '') => `${base}${p}`;
---

<header class="site-header">
  <nav class="nav">
    <h2 class="brand"><a href={base}>{SITE_TITLE}</a></h2>

    <!-- MOBILE TOGGLER (hidden on desktop) -->
    <details class="nav-toggle">
      <summary aria-label="Toggle navigation" role="button">
        ☰
      </summary>

      <!-- MENU PANEL (same links; desktop uses this inline, mobile as dropdown) -->
      <div class="menu-panel" id="primary-nav">
        <div class="internal-links">
          <HeaderLink href={link('')}>Home</HeaderLink>
          <HeaderLink href={link('blog/')}>Blog</HeaderLink>
          <HeaderLink href={link('templates/')}>Templates</HeaderLink>
          <HeaderLink href={link('books/')}>Books</HeaderLink>
          <HeaderLink href={link('albums/')}>Albums</HeaderLink>
          <HeaderLink href={link('art/')}>Art</HeaderLink>
          <HeaderLink href={link('inspirations/')}>Inspirations</HeaderLink>
          <HeaderLink href={link('guitar/')}>Guitar</HeaderLink>
          <HeaderLink href={link('projects/')}>Projects</HeaderLink>
          <HeaderLink href={link('about/')}>About</HeaderLink>
        </div>

        <div class="contact-button">
          <a href="mailto:smartstuffstays@gmail.com">Contact</a>
        </div>
      </div>
    </details>
  </nav>
</header>

<style>
  /* Base (desktop-first) — your original look */
  .site-header {
    margin: 0;
    padding: 0 1em;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,.05);
    position: sticky;
    top: 0;
    z-index: 50;
  }
  .nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: .5rem;
  }

  .brand { margin: 0; font-size: 1em; }
  .brand a, .brand a.active {
    text-decoration: none;
    color: var(--black, #0e121b);
    font-weight: 600;
  }

  /* Links styling (unchanged) */
  .internal-links :global(a) {
    padding: 1em .5em;
    color: var(--black, #0e121b);
    border-bottom: 4px solid transparent;
    text-decoration: none;
  }
  .internal-links :global(a.active) {
    border-bottom-color: var(--accent, #405cf5);
  }

  .contact-button a {
    background: transparent;
    color: #2563eb;
    border: 2px solid #2563eb;
    padding: .5rem 1.1rem;
    border-radius: 9999px;
    font-weight: 600;
    transition: all .25s ease;
    text-decoration: none;
    white-space: nowrap;
  }
  .contact-button a:hover { background:#2563eb; color:#fff; }

  /* ---- Desktop layout (exactly like before) ---- */
  .nav-toggle { display: contents; }          /* wrapper disappears on desktop */
  .nav-toggle > summary { display: none; }    /* hide hamburger */
  .menu-panel {
    display: flex;
    align-items: center;
    gap: .25rem;
  }
  .internal-links {
    display: flex;
    flex-wrap: nowrap;
    gap: .25rem;
  }

  /* ---- Mobile-only behavior ---- */
  @media (max-width: 900px) {
    .nav { position: relative; }

    /* Show hamburger */
    .nav-toggle { display: block; }
    .nav-toggle > summary {
      display: inline-block;
      border: 1px solid rgba(0,0,0,.12);
      background: #fff;
      border-radius: .6rem;
      padding: .45rem .65rem;
      font-size: 1.15rem;
      line-height: 1;
      cursor: pointer;
      list-style: none;
      user-select: none;
    }
    .nav-toggle > summary::-webkit-details-marker { display: none; }

    /* Dropdown panel defaults hidden until open */
    .menu-panel {
      position: absolute;
      left: 0; right: 0; top: 100%;
      background: #fff;
      border-top: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 8px 24px rgba(0,0,0,.06);
      display: none;
      flex-direction: column;
      align-items: stretch;
      padding: .25rem 0;
      z-index: 40;
    }
    .nav-toggle[open] .menu-panel { display: flex; }

    /* Compact grid for links */
    .internal-links {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
    }
    .internal-links :global(a) {
      padding: .85rem 1rem;
      border-bottom: 1px solid rgba(0,0,0,.04);
    }

    .contact-button { padding: .35rem 1rem .6rem; }
    .contact-button a { display: block; text-align: center; }
  }

  /* Extra-small phones → single column */
  @media (max-width: 420px) {
    .internal-links { grid-template-columns: 1fr; }
  }
</style>
