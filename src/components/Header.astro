---
import HeaderLink from './HeaderLink.astro';
import NavTooltipLink from './NavTooltipLink.astro';
import NavPulseStyles from './NavPulseStyles.astro';
import { SITE_TITLE } from '../consts';

const rawBase = import.meta.env.BASE_URL || '/';
const base = rawBase.endsWith('/') ? rawBase : `${rawBase}/`;
const link = (p: string = '') => `${base}${p}`;

// base-aware path so it works on subpaths too
const iconSrc = `${base}favicon.svg`;
---

<header class="site-header">
  <NavPulseStyles /> 
  <!-- ===== DESKTOP NAV ===== -->
  <nav class="desktop-nav">
    <h2>
      <a href={base} class="brand-link">
        <span class="site-title">{SITE_TITLE}</span>
        <img class="brandmark" src={iconSrc} width="20" height="20" alt="" aria-hidden="true" />
      </a>
    </h2>

    <div class="internal-links" id="desktop-links">
      <NavTooltipLink href={link('')} exact tip="Start here: overview and latest from the blog">
        Home
      </NavTooltipLink>
      <NavTooltipLink href={link('blog/')} tip="Essays on systems, stats, and experiments">
        Blog
      </NavTooltipLink>
      <NavTooltipLink href={link('templates/')} tip="Downloadable tools and Google Sheets systems">
        Templates
      </NavTooltipLink>
      <NavTooltipLink href={link('stats/')} tip="Live graphs and metrics from my Raw Data logs">
        Stats
      </NavTooltipLink>
      <NavTooltipLink href={link('books/')} tip="Every book I’ve read, with genres and notes">
        Books
      </NavTooltipLink>
      <NavTooltipLink href={link('albums/')} tip="Albums and listening history, powered by Raindrop">
        Albums
      </NavTooltipLink>
      <NavTooltipLink href={link('art/')} tip="Art I’ve logged that shaped my thinking">
        Art
      </NavTooltipLink>
      <NavTooltipLink href={link('guitar/')} tip="My guitar journey, pieces, and practice logs">
        Guitar
      </NavTooltipLink>
      <NavTooltipLink href={link('inspirations/')} tip="Ideas and people influencing LifeLoggerz">
        Inspirations
      </NavTooltipLink>
      <NavTooltipLink href={link('about/')} tip="What LifeLoggerz is and who’s behind it">
        About
      </NavTooltipLink>
    </div>

    <!-- Socials + Contact -->
    <div class="right-rail">
      <a
        class="social reddit"
        href="https://www.reddit.com/user/LifeLoggerz/"
        aria-label="LifeLoggerz on Reddit"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img src="/reddit.svg" width="22" height="22" alt="Reddit" />
      </a>

      <a
        class="social youtube"
        href="https://www.youtube.com/@LifeLoggerz"
        aria-label="LifeLoggerz on YouTube"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img src="/youtube.svg" width="22" height="22" alt="YouTube" />
      </a>

      <div class="contact-button">
        <a class="contact-pulse" href="mailto:lifeloggerz.official@gmail.com">Contact</a>
      </div>
    </div>
  </nav>

  <!-- ===== MOBILE NAV ===== -->
  <nav class="mobile-nav">
    <h2 class="brand">
      <a href={base} class="brand-link">
        <span class="site-title">{SITE_TITLE}</span>
        <img class="brandmark" src={iconSrc} width="20" height="20" alt="" aria-hidden="true" />
      </a>
    </h2>

    <details class="nav-toggle">
      <summary aria-label="Open menu">☰</summary>

      <div class="menu-panel">
        <div class="internal-links">
          <HeaderLink href={link('')}>Home</HeaderLink>
          <HeaderLink href={link('blog/')}>Blog</HeaderLink>
          <HeaderLink href={link('templates/')}>Templates</HeaderLink>
          <HeaderLink href={link('stats/')}>Stats</HeaderLink>
          <HeaderLink href={link('books/')}>Books</HeaderLink>
          <HeaderLink href={link('albums/')}>Albums</HeaderLink>
          <HeaderLink href={link('art/')}>Art</HeaderLink>
          <HeaderLink href={link('guitar/')}>Guitar</HeaderLink>
          <HeaderLink href={link('inspirations/')}>Inspirations</HeaderLink>
          <HeaderLink href={link('about/')}>About</HeaderLink>
        </div>

        <!-- Socials in mobile menu -->
        <div class="social-row">
          <a
            class="social reddit"
            href="https://www.reddit.com/user/LifeLoggerz/"
            aria-label="LifeLoggerz on Reddit"
            target="_blank"
            rel="noopener noreferrer"
          >
            <img src="/reddit.svg" width="22" height="22" alt="Reddit" />
          </a>

          <a
            class="social youtube"
            href="https://www.youtube.com/@LifeLoggerz"
            aria-label="LifeLoggerz on YouTube"
            target="_blank"
            rel="noopener noreferrer"
          >
            <img src="/youtube.svg" width="22" height="22" alt="YouTube" />
          </a>
        </div>

        <a class="contact-btn" href="mailto:lifeloggerz.official@gmail.com">Contact</a>
      </div>
    </details>
  </nav>
</header>

<style>
  /* Shared shell */
  .site-header {
    margin: 0;
    padding: 0 1rem;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,.05);
    position: sticky; top: 0; z-index: 50;
  }

  /* ===== DESKTOP styles ===== */
  .desktop-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: .5rem;
  }
  .desktop-nav h2 { margin: 0; font-size: 1em; }
  .desktop-nav h2 a { text-decoration: none; color: var(--black, #0e121b); font-weight: 600; }

  /* title + favicon inline */
  .brand-link { display: inline-flex; align-items: center; gap: .4rem; }
  .brandmark { display: block; width: 20px; height: 20px; }
  .site-title { line-height: 1; }

  .desktop-nav .internal-links {
    display: flex;
    flex-wrap: nowrap;
    gap: .25rem;
  }
  
  /* Base link styles */
  .desktop-nav .internal-links :global(a) {
    position: relative;
    padding: 1em .5em;
    color: var(--black, #0e121b);
    text-decoration: none;
    transition: transform 0.15s ease-out;
  }
  
  /* Underline pseudo-element (starts hidden) */
  .desktop-nav .internal-links :global(a)::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0.35rem; /* tweak if you want it closer/farther */
    width: 100%;
    height: 3px;
    border-radius: 999px;
    background: transparent;   /* no color by default */
    transform: scaleX(0);
    transform-origin: center;
    transition: transform 0.15s ease-out, background 0.15s ease-out;
  }
  
  /* Hover / focus = softer blue underline */
  .desktop-nav .internal-links :global(a:hover)::after,
  .desktop-nav .internal-links :global(a:focus-visible)::after {
    background: #3b7bff;       /* hover color */
    transform: scaleX(1);
  }
  
  /* Active page = stronger blue underline (wins even on hover) */
  .desktop-nav .internal-links :global(a.active)::after {
    background: #2563eb;       /* active color */
    transform: scaleX(1);
  }
  
  /* Tiny bump on hover */
  .desktop-nav .internal-links :global(a:hover),
  .desktop-nav .internal-links :global(a:focus-visible) {
    transform: translateY(-2px);
  }


  /* Contact + Social area */
  .right-rail {
    display: flex;
    align-items: center;
    gap: .6rem;
  }

  .contact-button a {
    background: transparent;
    color: #2563eb;
    border: 2px solid #2563eb;
    padding: .5rem 1.1rem;
    border-radius: 9999px;
    font-weight: 600;
    transition: all .25s;
    text-decoration: none;
    white-space: nowrap;
  }
  .contact-button a:hover {
    background: #2563eb;
    color: #fff;
  }

  .social {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    transition: transform .2s ease, opacity .2s ease, background .2s ease;
    opacity: 0.9;
  }
  .social:hover {
    transform: translateY(-1px);
    opacity: 1;
  }
  .social.reddit:hover { background: rgba(255, 69, 0, 0.1); }
  .social.youtube:hover { background: rgba(255, 0, 0, 0.1); }

  /* ===== MOBILE styles ===== */
  .mobile-nav {
    display: none;
    align-items: center;
    justify-content: space-between;
    gap: .5rem;
    position: relative;
  }
  .mobile-nav .brand { margin: 0; font-size: 1em; }
  .mobile-nav .brand a { text-decoration: none; color: var(--black, #0e121b); font-weight: 600; }

  .mobile-nav .nav-toggle > summary {
    display: inline-block;
    border: 1px solid rgba(0,0,0,.12);
    background: #fff;
    border-radius: .6rem;
    padding: .45rem .65rem;
    font-size: 1.15rem;
    line-height: 1;
    cursor: pointer;
    list-style: none;
    user-select: none;
  }
  .mobile-nav .nav-toggle > summary::-webkit-details-marker { display: none; }

  .mobile-nav .menu-panel {
    position: absolute;
    left: 0; right: 0; top: 100%;
    background: #fff;
    border-top: 1px solid rgba(0,0,0,.06);
    box-shadow: 0 8px 24px rgba(0,0,0,.06);
    display: none;
    flex-direction: column;
    align-items: stretch;
    padding: .25rem 0;
    z-index: 40;
  }
  .mobile-nav .nav-toggle[open] .menu-panel { display: flex; }

  .mobile-nav .internal-links {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
  }
  .mobile-nav .internal-links :global(a) {
    padding: .85rem 1rem;
    border-bottom: 1px solid rgba(0,0,0,.04);
    color: var(--black, #0e121b);
    text-decoration: none;
  }

  .mobile-nav .social-row {
    display: flex;
    gap: .6rem;
    padding: .5rem 1rem .25rem;
  }

  .mobile-nav .contact-btn {
    margin: .35rem 1rem .6rem;
    text-align: center;
    background: transparent;
    color: #2563eb;
    border: 2px solid #2563eb;
    padding: .5rem 1.1rem;
    border-radius: 9999px;
    font-weight: 600;
    transition: all .25s;
    text-decoration: none;
    white-space: nowrap;
  }
  .mobile-nav .contact-btn:hover {
    background: #2563eb;
    color: #fff;
  }

  /* ===== RESPONSIVE SWITCH ===== */
  @media (max-width: 900px) {
    .desktop-nav { display: none; }
    .mobile-nav { display: flex; }
  }

  /* === Contact button pulse === */
  @keyframes lifeloggerzContactPulse {
    0% {
      transform: scale(1);
      box-shadow: 0 0 0px rgba(37, 99, 235, 0.0);
    }
    40% {
      transform: scale(1.05);
      box-shadow: 0 0 14px rgba(37, 99, 235, 0.45);
    }
    100% {
      transform: scale(1);
      box-shadow: 0 0 0px rgba(37, 99, 235, 0.0);
    }
  }

  /* Use :global so Astro doesn’t scope this away */
  :global(.contact-button a.contact-pulse) {
    animation: lifeloggerzContactPulse 1.2s ease-in-out 0s infinite;
    transform-origin: center;
  }

  @media (prefers-reduced-motion: reduce) {
    :global(.contact-button a.contact-pulse) {
      animation: none !important;
      box-shadow: none !important;
      transform: none !important;
    }
  }
</style>
